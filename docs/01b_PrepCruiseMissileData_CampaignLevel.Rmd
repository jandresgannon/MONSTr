---
title: "06 Air Power Comparison"
author: "J Andres Gannon"
date: "February 23, 2018"
output:
  html_document:
    toc: yes
  html_notebook:
    toc: yes
    toc_float: yes
editor_options:
  chunk_output_type: inline
---
<style>
    body .main-container {
        max-width: 100%;
    }
</style>

# Campaign-level analysis of cruise missile aerial bombing campaigns
Start by loading the cleaned cruise missile data
Load finnicky packages
```{r}
library(magrittr)
library(ggplot2)
```

```{r}
cruise <- readRDS(file = paste0(here::here(), '/data/CruiseMissiles.rds'))
```

# Aggregate data
To merge the new cruise missile data with previous data on aerial bombing campaigns by the US, the unit of analysis has to be collapsed from the cruise missile incident level to the bombing campaign level.

Now the cruise missile dataset has to be reshaped to have the same unit of analysis which will be the war name. We'll subset the data to the identifier columns where each unique combination of the identifier columns should be a distinct military operation/row for the war. We can't just use the military operation name because some were targeted at multiple countries.

The identifier columns we want to keep are country names and COW codes, year, and the war name. The variable columns we want to keep are democracy/polity score and state_nonstate. The variable columns we'll have to add to the new data are political outcome, punishment, mixed, purepun, demand for regime change, other forces, watt values, industrialization, and sanctions. Other variable columns we'll want to add are whether the aerial bombing had cruise missiles or not 

```{r}
# Keep only the variables of interest for campaign merging
vars_id_campaign <- c("ccode1", # ID: COW Code Attacker
                      "ccode2", # ID: COW Code Defender
                      "initiator_country", # ID: Name of attacker
                      "target_country", # ID: Name of defender
                      "operation_year", #ID: Year
                      "war_wikidata_name", # ID: Merging War Name
                      "state_nonstate", # Control: rebel group target
                      "campaign_id" # ID: Unique row
                      )

cruise_campaign <- cruise[vars_id_campaign]

cruise_campaign <- unique(cruise_campaign)

# Fix some identifier column errors
cruise_campaign$ccode1 <- 2
names(cruise_campaign)[names(cruise_campaign) == 'operation_year'] <- 'year'
cruise_campaign <- unique(cruise_campaign)

names(cruise_campaign)[names(cruise_campaign) == 'initiator_country'] <- 'attacker1'
names(cruise_campaign)[names(cruise_campaign) == 'target_country'] <- 'defender2'
names(cruise_campaign)[names(cruise_campaign) == 'state_nonstate'] <- 'rebel'
```

# Add variables
## Add control variables
```{r}
# Add polity scores
polity <- readxl::read_excel("../inst/extdata/p4v2016.xls")
vars_polity <- c("ccode", "year", "polity2")
polity <- polity[vars_polity]

## Add for attacker country
names(polity) <- c("ccode1", "year", "polity")
cruise_campaign <- plyr::join(cruise_campaign, polity, by = c("ccode1", "year"), type = "left")
names(cruise_campaign)[names(cruise_campaign) == 'polity'] <- 'polity1'

## Add for defender country
names(polity) <- c("ccode2", "year", "polity")
cruise_campaign <- plyr::join(cruise_campaign, polity, by = c("ccode2", "year"), type = "left")
names(cruise_campaign)[names(cruise_campaign) == 'polity'] <- 'polity2'

# Add CINC scores
cinc <- read.csv("../inst/extdata/NMC_5_0.csv", header = TRUE)
vars_cinc <- c("ccode", "year", "cinc", "irst")
cinc <- cinc[vars_cinc]

## Add for attacker country, drop iron and steel score
names(cinc) <- c("ccode1", "year", "cinc", "irst")
cruise_campaign <- plyr::join(cruise_campaign, cinc, by = c("ccode1", "year"), type = "left")
names(cruise_campaign)[names(cruise_campaign) == 'cinc'] <- 'cinc1'
cruise_campaign$irst <- NULL

## Add for defender country, keep iron and steel score and log it
names(cinc) <- c("ccode2", "year", "cinc", "irst")
cruise_campaign <- plyr::join(cruise_campaign, cinc, by = c("ccode2", "year"), type = "left")
names(cruise_campaign)[names(cruise_campaign) == 'cinc'] <- 'cinc2'
names(cruise_campaign)[names(cruise_campaign) == 'irst'] <- 'steel2'
cruise_campaign$steel2 <- log(cruise_campaign$steel2)
cruise_campaign$steel2 <- NULL # We drop this variable since it has so many missing value, especially for the newer cases

# Make a new column that identifies that observation as having cruise missiles
cruise_campaign$cruise <- 1
```

## Add variables from previous datasets
```{r}
## Democracy dummy used in Allen 2017
### Attacker
cruise_campaign$dem1 <- ifelse(cruise_campaign$polity1 > 6, 1, 0)

### Defender
cruise_campaign$dem2 <- ifelse(cruise_campaign$polity2 > 6, 1, 0)

## Time squared used in Allen 2017
cruise_campaign$year2 <- cruise_campaign$year^2

## Fix rebel variable to be binary
cruise_campaign$rebel <- dplyr::recode(cruise_campaign$rebel,
                                       "State" = 0,
                                       "Nonstate" = 1)

## Add temporary name for the 1998 bombing cases
cruise_campaign$war_wikidata_name <- ifelse(is.na(cruise_campaign$war_wikidata_name), 'Operation Infinite Reach', cruise_campaign$war_wikidata_name)
```

## Code new variables for the new cruise missile cases
### Political outcome
```{r}
cruise_campaign$poloutcome <- NA

cruise_campaign[cruise_campaign$year == "1993", "poloutcome"] <- 1 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "poloutcome"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "poloutcome"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "2008", "poloutcome"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "poloutcome"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "poloutcome"] <- 1 # Libya
cruise_campaign[cruise_campaign$year == "2014", "poloutcome"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2016", "poloutcome"] <- 1 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "poloutcome"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "poloutcome"] <- 0 # Syria


# Copy coding from Horowitz/Allen for the cases they also include
cruise_campaign[cruise_campaign$year == "1991", "poloutcome"] <- 1 # Gulf War
cruise_campaign[cruise_campaign$year == "1995", "poloutcome"] <- 1 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "poloutcome"] <- 1 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "poloutcome"] <- 0 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1999", "poloutcome"] <- 1 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "poloutcome"] <- 0 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "poloutcome"] <- 1 # Iraq war
```

### Mixed counterforce and countervalue targeting
```{r}
cruise_campaign$mixed <- NA

cruise_campaign[cruise_campaign$year == "1993", "mixed"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "mixed"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "mixed"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "2008", "mixed"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "mixed"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "mixed"] <- 0 # Libya
cruise_campaign[cruise_campaign$year == "2014", "mixed"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2016", "mixed"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "mixed"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "mixed"] <- 0 # Syria

# Copy coding from Horowitz/Allen for the cases they also include
cruise_campaign[cruise_campaign$year == "1991", "mixed"] <- 0 # Gulf War
cruise_campaign[cruise_campaign$year == "1995", "mixed"] <- 0 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "mixed"] <- 0 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "mixed"] <- 0 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1999", "mixed"] <- 1 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "mixed"] <- 0 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "mixed"] <- 0 # Iraq war
```

### Pure punishment/countervalue targeting
```{r}
cruise_campaign$purepun <- NA

cruise_campaign[cruise_campaign$year == "1993", "purepun"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "purepun"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "purepun"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "2008", "purepun"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "purepun"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "purepun"] <- 0 # Libya
cruise_campaign[cruise_campaign$year == "2014", "purepun"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2016", "purepun"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "purepun"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "purepun"] <- 0 # Syria

# Copy coding from Horowitz/Allen for the cases they also include
cruise_campaign[cruise_campaign$year == "1991", "purepun"] <- 0 # Gulf War
cruise_campaign[cruise_campaign$year == "1995", "purepun"] <- 0 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "purepun"] <- 0 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "purepun"] <- 0 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1999", "purepun"] <- 0 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "purepun"] <- 0 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "purepun"] <- 0 # Iraq war
```

### Gravity
```{r}
cruise_campaign$gravity <- NA

cruise_campaign[cruise_campaign$year == "1993", "gravity"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "gravity"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "gravity"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "2008", "gravity"] <- 1 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "gravity"] <- 1 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "gravity"] <- 1 # Libya
cruise_campaign[cruise_campaign$year == "2014", "gravity"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2016", "gravity"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "gravity"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "gravity"] <- 0 # Syria

# Copy coding from Horowitz/Allen for the cases they also include
cruise_campaign[cruise_campaign$year == "1991", "gravity"] <- 0 # Gulf War
cruise_campaign[cruise_campaign$year == "1995", "gravity"] <- 0 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "gravity"] <- 0 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "gravity"] <- 0 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1999", "gravity"] <- 0 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "gravity"] <- 0 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "gravity"] <- 1 # Iraq war
```

### Other ground or naval forces
```{r}
cruise_campaign$othforces <- NA

cruise_campaign[cruise_campaign$year == "1993", "othforces"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "othforces"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "othforces"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "2008", "othforces"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "othforces"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "othforces"] <- 1 # Libya
cruise_campaign[cruise_campaign$year == "2014", "othforces"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2016", "othforces"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "othforces"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "othforces"] <- 0 # Syria

# Copy coding from Horowitz/Allen for the cases they also include
cruise_campaign[cruise_campaign$year == "1991", "othforces"] <- 1 # Gulf War
cruise_campaign[cruise_campaign$year == "1995", "othforces"] <- 1 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "othforces"] <- 1 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "othforces"] <- 0 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1999", "othforces"] <- 1 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "othforces"] <- 1 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "othforces"] <- 1 # Iraq war
```

### Multilateral
```{r}
cruise_campaign$multilateral <- NA

cruise_campaign[cruise_campaign$year == "1991", "multilateral"] <- 1 # Gulf War
cruise_campaign[cruise_campaign$year == "1993", "multilateral"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1995", "multilateral"] <- 1 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "multilateral"] <- 0 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "multilateral"] <- 1 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "multilateral"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "multilateral"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1999", "multilateral"] <- 1 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "multilateral"] <- 1 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "multilateral"] <- 1 # Iraq war
cruise_campaign[cruise_campaign$year == "2008", "multilateral"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "multilateral"] <- 1 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "multilateral"] <- 1 # Libya
cruise_campaign[cruise_campaign$year == "2014", "multilateral"] <- 1 # Syria
cruise_campaign[cruise_campaign$year == "2016", "multilateral"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "multilateral"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "multilateral"] <- 1 # Syria

```

### Aerial mixed (cruise missiles plus non-cruise missile bombing)
```{r}
cruise_campaign$aerialmixed <- NA

cruise_campaign[cruise_campaign$year == "1991", "aerialmixed"] <- 1 # Gulf War
cruise_campaign[cruise_campaign$year == "1993", "aerialmixed"] <- 0 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1995", "aerialmixed"] <- 1 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "aerialmixed"] <- 0 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "aerialmixed"] <- 1 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "aerialmixed"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "aerialmixed"] <- 0 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1999", "aerialmixed"] <- 1 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "aerialmixed"] <- 1 # Afghanistan
cruise_campaign[cruise_campaign$year == "2003", "aerialmixed"] <- 1 # Iraq war
cruise_campaign[cruise_campaign$year == "2008", "aerialmixed"] <- 0 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "aerialmixed"] <- 1 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "aerialmixed"] <- 1 # Libya
cruise_campaign[cruise_campaign$year == "2014", "aerialmixed"] <- 1 # Syria
cruise_campaign[cruise_campaign$year == "2016", "aerialmixed"] <- 0 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "aerialmixed"] <- 0 # Syria
cruise_campaign[cruise_campaign$year == "2018", "aerialmixed"] <- 0 # Syria

```

# Cruise missile variables
The following variables are unique to the cases that included cruise missiles, so they won't be relevant for replication of prior findings or merging this dataset with other datasets on aerial bombing.

## Number of unique launch platforms involved
A launch platform is defined as any individual ship or bomber
```{r}
# Overall
count_platformcountbywar <- cruise %>%
  dplyr::group_by(campaign_id) %>%
  dplyr::summarise(dplyr::n_distinct(launch_name_wikidata_name))

cruise_campaign <- dplyr::left_join(cruise_campaign, count_platformcountbywar)

names(cruise_campaign)[names(cruise_campaign) == 'n_distinct(launch_name_wikidata_name)'] <- 'platformcount_total'

# By type of platform
count_platformtypebywar <- cruise %>%
  dplyr::group_by(campaign_id, platform_type) %>%
  dplyr::summarise(dplyr::n_distinct(launch_name_wikidata_name))

count_platformtypebywar <- tidyr::spread(count_platformtypebywar, platform_type, 'dplyr::n_distinct(launch_name_wikidata_name)')

count_platformtypebywar[is.na(count_platformtypebywar)] <- 0

count_platformtypebywar <- count_platformtypebywar %>% dplyr::rename(platformlogical_air = Air, platformcount_sea_surface = Surface, platformcount_sea_subsurface = Submarine, platform_unknown = `<NA>`)

cruise_campaign <- dplyr::left_join(cruise_campaign, count_platformtypebywar)

cruise_campaign$platformlogical_sea_surface <- ifelse(cruise_campaign$platformcount_sea_surface > 0, 1, 0)
cruise_campaign$platformlogical_sea_subsurface <- ifelse(cruise_campaign$platformcount_sea_subsurface > 0, 1, 0)
```

## Number of cruise missiles fired
Need to see if this way of separating out Operation Viking Hammer from the rest of the Iraq War makes sense
```{r}
# Overall
cruise_campaign$missilecount_total <- NA

cruise_campaign[cruise_campaign$year == "1991", "missilecount_total"] <- 288 # Gulf War
cruise_campaign[cruise_campaign$year == "1993", "missilecount_total"] <- 66 # Iraqi no-fly zones
cruise_campaign[cruise_campaign$year == "1995", "missilecount_total"] <- 13 # Bosnian War
cruise_campaign[cruise_campaign$year == "1996", "missilecount_total"] <- 31 # Iraqi Kurdish civil war
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Iraq", "missilecount_total"] <- 415 # Iraqi no fly-zones
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Afghanistan", "missilecount_total"] <- 73 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1998" & cruise_campaign$defender2 == "Sudan", "missilecount_total"] <- 6 # Operation Infinite Reach
cruise_campaign[cruise_campaign$year == "1999", "missilecount_total"] <- 470 # Kosovo war
cruise_campaign[cruise_campaign$year == "2001", "missilecount_total"] <-  # Afghanistan
cruise_campaign[cruise_campaign$year == "2003" & cruise_campaign$rebel == 0, "missilecount_total"] <- 802 # Iraq war
cruise_campaign[cruise_campaign$year == "2003" & cruise_campaign$rebel == 1, "missilecount_total"] <- 64 # Iraq war
cruise_campaign[cruise_campaign$year == "2008", "missilecount_total"] <- 5 # Somalia
cruise_campaign[cruise_campaign$year == "2009", "missilecount_total"] <- 2 # Yemen
cruise_campaign[cruise_campaign$year == "2011", "missilecount_total"] <- 112 # Libya
cruise_campaign[cruise_campaign$year == "2014", "missilecount_total"] <- 47 # Syria
cruise_campaign[cruise_campaign$year == "2016", "missilecount_total"] <- 5 # Yemen
cruise_campaign[cruise_campaign$year == "2017", "missilecount_total"] <- 59 # Syria
cruise_campaign[cruise_campaign$year == "2018", "missilecount_total"] <- 85 # Syria

# Number of missiles per platform


# Percent of missiles per platform


```

## Merge with target data
```{r}
# Create new target data columns
cruise_campaign$cruise_vessel_count <- NA
cruise_campaign$missile_capacity <- NA
cruise_campaign$duration <- NA

#Drop redundant columns
cruise_campaign$`dplyr::n_distinct(launch_name_wikidata_name)` <- NULL

#Rename cruise missile platform columns
names(cruise_campaign)[names(cruise_campaign) == 'platformlogical_air'] <- 'cruise_air_binary'
names(cruise_campaign)[names(cruise_campaign) == 'platformcount_sea_subsurface'] <- 'cruise_subsurface_count'
names(cruise_campaign)[names(cruise_campaign) == 'platformcount_sea_subsurface'] <- 'cruise_surface_count'
names(cruise_campaign)[names(cruise_campaign) == 'platformlogical_sea_surface'] <- 'cruise_surface_binary'
names(cruise_campaign)[names(cruise_campaign) == 'platformcount_sea_surface'] <- 'cruise_surface_count'
names(cruise_campaign)[names(cruise_campaign) == 'platformlogical_sea_subsurface'] <- 'cruise_subsurface_binary'
names(cruise_campaign)[names(cruise_campaign) == 'platform_unknown'] <- 'cruise_platform_unknown'
names(cruise_campaign)[names(cruise_campaign) == 'missilecount_total'] <- 'cruise_total_count'
names(cruise_campaign)[names(cruise_campaign) == 'missile_capacity'] <- 'cruise_total_capacity'
```

# More cleaning
```{r}
# Target democracy value is 0 for non-state targets
cruise_campaign$dem2 <- ifelse(cruise_campaign$rebel == 1, 0, cruise_campaign$dem2)
```

# Disaggregate by war-platform
```{r}
cruise_campaign_platform <- pull_live_googledoc_cruise_platform()

# Choose the columns from cruise_campaign we want to merge into the platform-level data
vars_cruise_campaign <- c("ccode1",
                          "ccode2",
                          "attacker1",
                          "defender2",
                          "rebel",
                          "campaign_id",
                          "polity1",
                          "polity2",
                          "cinc1",
                          "cinc2",
                          "dem1",
                          "dem2",
                          "year2",
                          "othforces",
                          "multilateral",
                          "aerialmixed")

# Merge by campaign ID
cruise_campaign_merge <- cruise_campaign[vars_cruise_campaign]

cruise_campaign_platform_full <- plyr::join(cruise_campaign_platform, cruise_campaign_merge, by = 'campaign_id', type = 'left', match = 'all')
cruise_campaign_platform_full$operation_notes <- NULL

# Clean names for uniform standard
names(cruise_campaign_platform_full)[names(cruise_campaign_platform_full) == 'rebel'] <- 'target_rebel'
names(cruise_campaign_platform_full)[names(cruise_campaign_platform_full) == 'othforces'] <- 'strike_nonbombingforces'
names(cruise_campaign_platform_full)[names(cruise_campaign_platform_full) == 'multilateral'] <- 'strike_multilateral'
names(cruise_campaign_platform_full)[names(cruise_campaign_platform_full) == 'aerialmixed'] <- 'strike_mixedbombing'

# Re-order columns for easier viewing
cruise_campaign_platform_full <- cruise_campaign_platform_full[ , c("campaign_id",
                                                                 "war_wikidata_name",
                                                                 "year",
                                                                 "year2",
                                                                 "ccode1",
                                                                 "attacker1",
                                                                 "polity1",
                                                                 "dem1",
                                                                 "cinc1",
                                                                 "ccode2",
                                                                 "defender2",
                                                                 "polity2",
                                                                 "dem2",
                                                                 "cinc2",
                                                                 "cruise_platform",
                                                                 "platform_used",
                                                                 "strike_legal",
                                                                 "strike_covert",
                                                                 "strike_allydependent",
                                                                 "strike_nonbombingforces",
                                                                 "strike_multilateral",
                                                                 "strike_mixedbombing",
                                                                 "target_static",
                                                                 "target_rebel",
                                                                 "target_military",
                                                                 "target_civilian",
                                                                 "target_infra_econ",
                                                                 "target_infra_urban",
                                                                 "target_defense",
                                                                 "target_retal",
                                                                 "target_disperse")]
```

# Add Variables
## Coastline
```{r}
### Read in csv containing coastline data in miles
coast <- read.csv(paste0(here::here(), "/data/cia_world_factbook_coastlines.csv"))

### Merge 
cruise_campaign_platform_full <- merge(cruise_campaign_platform_full, coast, by.x = "defender2", by.y = "country", all.x = TRUE)

### Add missing coastline length
cruise_campaign_platform_full[cruise_campaign_platform_full$defender2 == "Yugoslavia", "coastline"] <- coast[coast$country == "Bosnia and Herzegovina", "coastline"] + coast[coast$country == "Croatia", "coastline"] + coast[coast$country == "Kosovo", "coastline"] + coast[coast$country == "Macedonia", "coastline"] + coast[coast$country == "Montenegro", "coastline"] + coast[coast$country == "Serbia", "coastline"] + coast[coast$country == "Slovenia", "coastline"]
```

Variables we'll want to try to create:

platform_count - number of vessels from that platform that fired cruise missiles. This should be cruise_subsurface_count and cruise_surface_count for the appropriate rows. We do not yet have an equivalent for cruise_air_count.

missiles_count - number of cruise missiles fired from that platform during that war
missiles_ratio - percent of cruise missiles fired from that platform during that war. The denominator here is cruise_total_count

time_start - when this platform was first firing cruise missiles during the war
time_end - when this platform was last firing cruise missiles during the war
time_from_start - how many days into the war passed before this platform fired its first missiles
time_duration - how much time passed from time_start to time_end
time_

# Save
Now that the data preparation is done, we can save the dataset
```{r}
saveRDS(cruise_campaign_platform_full, paste0(here::here(), "/data/","CruiseMissilesCampaign.rds"))
```

# ####Legacy code

# #####Sorting
# Merging
We first load the dataset of all campaigns in which the US employed cruise missiles.
```{r}
cruise_campaign <- readRDS(file = paste0(here::here(), '/data/CruiseMissilesCampaign.rds'))
cruise_campaign$cruise <- 1
```

## Prepare for merging
We add an identifier variable from the cruise missile dataset to the ICB dataset 
```{r}
### Campaign ID
crisis$campaign_id <- NA
crisis[crisis$crisname == "GULF WAR", "campaign_id"] <- 2
crisis[crisis$crisname == "DESERT STRIKE", "campaign_id"] <- 1
crisis[crisis$crisname == "US EMBASSY BOMBINGS", "campaign_id"] <- 16
crisis[crisis$crisname == "UNSCOM II", "campaign_id"] <- 8
crisis[crisis$crisname == "KOSOVO", "campaign_id"] <- 6
crisis[crisis$crisname == "AFGHANISTAN/US", "campaign_id"] <- 9
crisis[crisis$crisname == "IRAQ REGIME CHANGE", "campaign_id"] <- 3
crisis[crisis$crisname == "LIBYAN CIVILWAR", "campaign_id"] <- 10
```

## Merge 
```{r}
# Keep only the variables of interest for campaign merging
vars_id_campaign <- c("target_rebel", # Control: rebel group target
                      "campaign_id", # ID: Unique row
                      "cruise"
                      )


cruise_campaign <- cruise_campaign[vars_id_campaign]

crisis <- plyr::join(crisis, cruise_campaign, by = c("campaign_id"), type = "left")
```

# Fill in variables from merging
## Were cruise missiles used
```{r}
### Code anything not in cruise_campaign as negative
crisis[is.na(crisis$cruise), "cruise"] <- 0
```

## State or nonstate actor
```{r}
crisis[crisis$crisname == "LIBYAN JETS", "rebel"] <- 0
crisis[crisis$crisname == "INVASION OF PANAMA", "rebel"] <- 0
crisis[crisis$crisname == "N. KOREA NUCLEAR I", "rebel"] <- 0
crisis[crisis$crisname == "HAITI MIL. REGIME", "rebel"] <- 0
crisis[crisis$crisname == "IRAQ DEPLOY./KUWAIT", "rebel"] <- 0
crisis[crisis$crisname == "UNSCOM I", "rebel"] <- 0
crisis[crisis$crisname == "N. KOREA NUCLEAR II", "rebel"] <- 0
crisis[crisis$crisname == "IRAN NUCLEAR II", "rebel"] <- 0
crisis[crisis$crisname == "N. KOREA NUCLEAR III", "rebel"] <- 0
crisis[crisis$crisname == "N. KOREA NUCLEAR IV-SATELLITE LAUNCH", "rebel"] <- 0
crisis[crisis$crisname == "N. KOREA NUCLEAR V", "rebel"] <- 0
crisis[crisis$crisname == "SYRIA CHEMICAL WEAPONS", "rebel"] <- 0
crisis[crisis$crisname == "TURKEY-RUSSIA JET INCIDENT", "rebel"] <- 0
```
