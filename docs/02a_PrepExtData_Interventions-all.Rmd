---
title: "03b Prep Cruise Missile Data Merge US Conflict"
author: "J Andres Gannon, Cole Reynolds, Tom Brailey"
date: "04/20/18"
output:
  html_document:
    toc: yes
  html_notebook:
    toc: yes
    toc_float: yes
editor_options:
  chunk_output_type: inline
---
<style>
    body .main-container {
        max-width: 100%;
    }
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
```

Our universe of cases is US intervention after the Cold War.

We start by identifying list of US interventions coded in existing IR datasets as well as their temporal scope. We can then compare their coverage to see what covariates may conflict and where things may be missing.

The first step will be loading each dataset and subsetting it to the appropriate actor (US as intervenor) and time period (post-Cold War).

# ICB
The International Crisis Behavior (ICB) datasets concerns international crises that may or may not have escalated to war
## Load
```{r}
icb <- read.csv(paste0(here::here(),"/inst/extdata/icb2v12.csv"))
```

## Filter
We now filter the dataset so that it only includes the crisis in which the United States was an actor in the post-Cold War period.
```{r}
icb <- dplyr::filter(icb, yrtrig >= 1989)
icb <- dplyr::filter(icb, actor == "USA")
```

## Summarize
```{r}
dplyr::glimpse(icb)
DataExplorer::plot_histogram(icb)
```

# IMI
## Load
The IMI dataset includes international military interventions from 1946-2005. It defines interventions as "the movement of regular troops or forces (airborne, seaborne, shelling, etc) of one country inside another, in the context of some political issue or dispute"

Pearson, Frederic S., and Robert A. Baumann.  1993.  “International Military Intervention, 1946-1988.”  Inter-University Consortium for Political and Social Research, Data Collection No 6035, University of Michigan, Ann Arbor.

Kisangani, Emizet F., and Jeffrey Pickering.  2008.  “International Military Intervention, 1989-2005.”  Inter-University Consortium for Political and Social Research, Data Collection No 21282, University of Michigan, Ann Arbor.
```{r}
imi <- read.csv(paste0(here::here(),"/inst/extdata/IMI/IMI_dataset.csv"))
```

## Filter
We now filter the dataset so that it only includes the crisis in which the United States was an actor in the post-Cold War period.
```{r}
# 8-digit yyyymmdd used for date formating
imi <- dplyr::filter(imi, start >= 19890101)
imi$start <- gsub('.{4}$', '', imi$start)

# Uses COW country code
imi <- dplyr::filter(imi, intervener == 2)
```

## Summarize
```{r}
dplyr::glimpse(imi)
DataExplorer::plot_histogram(imi)
```

# MIPS
## Load
The MIPS dataset codes Military Interventions by Powerful States from 1946-2003. It includes the US, China, France, and Russia using force against state and non-state targets as well as their politicla objects, the costs of the operation, and the interventions outcomes.

Sullivan, Patricia L., and Michael T. Koch. 2009. "Military Intervention by Powerful States, 1945-2003." Journal of Peace Research 46 (5): 707-718.
```{r}
mips <- read.csv(paste0(here::here(),"/inst/extdata/MIPS/MIPS_dataset.csv"))
```

## Filter
We now filter the dataset so that it only includes the interventions in which the United States was an actor in the post-Cold War period.
```{r}
mips <- dplyr::filter(mips, styr >= 1989)
mips <- dplyr::filter(mips, MP == 2)
```

## Summarize
```{r}
dplyr::glimpse(mips)
DataExplorer::plot_histogram(mips)
```

#PRIO
## Load
The PRIO dataset on armed conflict includes internal and external conflicts from 1946-2008.

Gleditsch, Nils Petter; Peter Wallensteen, Mikael Eriksson, Margareta Sollenberg & Håvard Strand, 2002. ‘Armed Conflict 1946–2001: A New Dataset’, Journal of Peace Research 39(5): 615–637.

```{r}
prio <- read.csv(paste0(here::here(),"/inst/extdata/PRIO/UCDP-PRIO_armed_conflict_dataset.csv"))
```

## Filter
We now filter the dataset so that it only includes the interventions in which the United States was an actor in the post-Cold War period.
```{r}
prio <- dplyr::filter(prio, year >= 1989)

# PRIO does not use the GW identifier. It is confirmed that this refers to the USA
prio <- dplyr::filter(prio, side_a_id == 3)
```

## Summarize
```{r}
dplyr::glimpse(prio)
DataExplorer::plot_histogram(prio)
```

# MIDs
## Load
The MIDs dataset covers all conflicts in which a state threatens, displays, or uses force against another state from 1816-2010.

Palmer, Glenn, Vito D'Orazio, Michael R. Kenwick, and Roseanne W. McManus. Forthcoming. “Updating the Militarized Interstate Dispute Data: A Response to Gibler, Miller, and Little.” International Studies Quarterly.

Dispute level dataset is chosen at the participant level to best identify broader disputes where the US was an actor. Disputes are inclusive of their incidents and the participant-level data allows us to subset to the US. Covariates for those disputes can later be merged from the dispute-level dataset
```{r}
mids <- read.csv(paste0(here::here(),"/inst/extdata/MIDs/MIDs_dispute-participants.csv"))
```

## Filter
We now filter the dataset so that it only includes the interventions in which the United States was an actor in the post-Cold War period.
```{r}
mids <- dplyr::filter(mids, styear >= 1989)
mids <- dplyr::filter(mids, ccode == 2)
```

## Summarize
```{r}
dplyr::glimpse(mids)
DataExplorer::plot_histogram(mids)
```

# RAND
## Load

RAND has a forthcoming dataset on US military interventions. from 1898-2016. Because the raw data is not yet public, the list of cases is taken from their appendix and copied into a dataframe.

Kavanagh, Jennifer, Bryan Frederick, Alexandra Stark, Nathan Chandler, Meagan L. Smith, Matthew Povlock, Lynn E. Davis, and Edward Geist, Characteristics of Successful U.S. Military Interventions. Santa Monica, CA: RAND Corporation, 2019. https://www.rand.org/pubs/research_reports/RR3062.html. Also available in print form.
```{r}
rand <- read.csv(paste0(here::here(),"/inst/extdata/rand_interventionlist.csv"))
```

## Filter
We now filter the dataset so that it only includes the interventions in the post-Cold War period.
```{r}
rand <- dplyr::filter(rand, incident_start_year >= 1989)
```

## Summarize
```{r}
dplyr::glimpse(rand)
DataExplorer::plot_histogram(rand)
```

# MIP
Kushi, Sidita, and Monica Duffy Toft. “Introducing the Military Intervention Project: A New Dataset on US Military Interventions, 1776–2019.” Journal of Conflict Resolution, August 8, 2022, 00220027221117546. https://doi.org/10.1177/00220027221117546.

## Load
```{r}
mip <- haven::read_dta(paste0(here::here(),"/inst/extdata/MIP/MIPDataKushiToft.dta"))
```

## Filter
```{r}
mip <- mip %>%
  dplyr::filter(styear >= 1989 &
                  RemoveCase == 0)
```

## Summarize
```{r}
dplyr::glimpse(mip)
DataExplorer::plot_histogram(mip)
```

# Merge
Now that we know the interventions each dataset identifies for the US post-1989, we can compare them and see what cases each one covers. Then we merge those cases to get a non-duplicated list of interventions for which we want to identify the campaigns and operations. Each dataset should have each US intervention as a unique row.

Rather than trying to manually merge each dataset to one another, the easiest method will be merging each observation from each dataset to the Q code for that event. Then we see which Q codes match up

## Subset
Subset to only variables useful for Q code identification
To help coders identify the ccode for each observation, we'll want the name provided by the dataset, target country, and date
### ICB
```{r}
# Subset to relevant columns
colnames(icb)
icb_id <- icb[ , c('yrtrig', 'crisname')]

# Standardize column names
icb_id <- icb_id %>% dplyr::rename('Year' = yrtrig,
                                   'Intervention' = crisname)

# Create identifier column
icb_id$dataset <- 'icb'
icb_id$Intervention <- as.character(icb_id$Intervention)
```

### IMI
```{r}
## Subset to relevant columns
colnames(imi)
imi_id <- imi[ , c('target', 'start', 'description')]

## Add country name from ccode
imi_id$target <- countrycode::countrycode(imi_id$target, "cown", "country.name")

## Standardize column names
imi_id <- imi_id %>% dplyr::rename('Target' = target,
                                   'Intervention' = description,
                                   'Year' = start)

## Create identifier column
imi_id$dataset <- 'imi'
imi_id$Intervention <- as.character(imi_id$Intervention)

```

### MIPS
```{r}
# Subset to relevant columns
colnames(mips)
mips_id <- mips[ , c('location', 'intervention', 'styr')]

## Set country names so they are not numeric factors
mips_id$location <- as.character(mips_id$location)

# Standardize column names
mips_id <- mips_id %>% dplyr::rename('Target' = location,
                                   'Intervention' = intervention,
                                   'Year' = styr)

# Create identifier column
mips_id$dataset <- 'mips'
mips_id$Intervention <- as.character(mips_id$Intervention)
```

### PRIO
```{r}
# Subset to relevant columns
colnames(prio)
prio_id <- prio[ , c('side_b', 'year')]

## Make clear the target name is Al-Qaeda
prio_id$side_b <- 'Al-Qaeda'

# Standardize column names
prio_id <- prio_id %>% dplyr::rename('Target' = side_b,
                                   'Year' = year)

# Create identifier column
prio_id$dataset <- 'prio'
```

### MIDS
```{r}
# Subset to relevant columns
colnames(mids)
mids_id <- mids[ , c('dispnum3', 'styear')]

# Standardize column names
mids_id <- mids_id %>% dplyr::rename('Intervention' = dispnum3,
                                   'Year' = styear)

# Create identifier column
mids_id$dataset <- 'mids'
```

### RAND
```{r}
# Subset to relevant columns
colnames(rand)
rand_id <- rand[ , c('operation_name', 'target_country', 'incident_start_year')]

# Standardize column names
rand_id <- rand_id %>% dplyr::rename('Year' = incident_start_year,
                                   'Intervention' = operation_name,
                                   'Target' = target_country)

# Create identifier column
rand_id$dataset <- 'rand'
rand_id$Intervention <- as.character(rand_id$Intervention)
```

### MIP
```{r}
# Subset to relevant columns
mip_id <- mip %>%
  dplyr::select(styear, Name, StateB)

# Standardize column names
mip_id <- mip_id %>%
  dplyr::rename('Year' = styear,
                'Intervention' = Name,
                'Target' = StateB)

mip_id$dataset <- 'mip'
mip_id$Intervention <- as.character(mip_id$Intervention)
```

## Create blank dataset
Now that we have standardized identifier columns across all the datasets, we can rbind them into a single dataset that we then export to a googlesheet. The coders can then identify the qcodes for each event using the information provided
```{r}
# Coerce to df
combined_id <- plyr::rbind.fill(icb_id, imi_id, mids_id, mips_id, prio_id, rand_id, mip_id)

# Add columns to be filled by coders
combined_id$wikidata_name <- NA
combined_id$wikidata_id <- NA
```

## Save
Save blank dataset for manual entry in google docs
```{r}
write.csv(combined_id, paste0(here::here(), "/data/","02a_interventions_priordata-all.csv"))
```
